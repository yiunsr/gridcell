<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../slickgrid/slick.grid.css">
		<link rel="stylesheet" type="text/css" href="../slickgrid/css/smoothness/jquery-ui-1.11.3.custom.css">
		<link rel="stylesheet" type="text/css" href="../slickgrid/examples/examples.css">
		<link rel="stylesheet" type="text/css" href="../css/grid.css">
  </head>
  <body>

		<div id="myGrid"></div>

    <script>
    jQuery = window.$ = window.jQuery = require('jquery');
		require('../../renderer.js');
		const {ipcRenderer} = require('electron');
    </script>


	<script src="../js/bootstrap.min.js"> </script>
	<script src="../slickgrid/lib/jquery-ui-1.11.3.min.js"></script>
    <script src="../slickgrid/lib/jquery.event.drag-2.3.0.js"></script>
    <script src="../slickgrid/slick.core.js"></script>
	<script src="../slickgrid/slick.grid.js"></script>

	<script src="../slickgrid/plugins/slick.cellrangedecorator.js"></script>
	<script src="../slickgrid/plugins/slick.cellrangeselector.js"></script>
	<script src="../slickgrid/plugins/slick.cellselectionmodel.js"></script>
	<script src="../slickgrid/slick.formatters.js"></script>
	<script src="../slickgrid/slick.editors.js"></script>
	<script src="../slickgrid/slick.grid.js"></script>

	<script src="../js/util_render.js"></script>

  <script>
	var start_time = new Date();
	var grid;
	var COL_COUNT = 20;

	var columns = [
		{id: "id", name: "id", field: "id"}
	];

	function initGrid(){
		var index = 0;

		for(index = 0; index < COL_COUNT; index++){
			var colname = getColName(index+1)
			var item = {id: colname, name: colname, field: colname, editor: Slick.Editors.LongText};
			columns.push(item);
		}

		var options = {
			editable: true,
			enableAddRow: true,
			enableCellNavigation: true,
			enableColumnReorder: true,
			asyncEditorLoading: false,
			autoEdit: false,
			editCommandHandler: queueAndExecuteCommand
		};

		var data = [];
		for (var i = 0; i < 1000000; i++) {
			var item = {id: i};
			for(index = 0; index < COL_COUNT; index++){
				var colname = getColName(index+1)
				item[colname] = i;
			}
			data.push(item);
		}
		var spend_time = ((new Date)-start_time) / 1000;
		console.log("data ready : " + spend_time);
		grid = new Slick.Grid("#myGrid", data, columns, options);
		spend_time = ((new Date)-start_time) / 1000;
		console.log("grid : " + spend_time);
	}
		
	
	var commandQueue = [];
	function queueAndExecuteCommand(item, column, editCommand) {
		commandQueue.push(editCommand);
		editCommand.execute();
	}

	function undo() {
		var command = commandQueue.pop();
		if (command && Slick.GlobalEditorLock.cancelCurrentEdit()) {
			command.undo();
			grid.gotoCell(command.row, command.cell, false);
		}
	}
	
	$(function(){
		initGrid();
	});
	
	ipcRenderer.on('api', (event, data) => {
      apiReceiver(data);
    })
	
	</script>
  </body>
</html>
